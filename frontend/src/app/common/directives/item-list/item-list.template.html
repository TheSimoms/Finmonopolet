<!-- Filtering -->
<div class="row my-3">
    <!-- Search -->
    <div class="offset-lg-3 col-lg-4">
        <label for="search">Søk etter vare:</label>
        <input id="search" type="text" class="form-control" ng-model="searchString"
               placeholder="Baileys, akevitt, Spania, 2017…"
               ng-model-options="{ debounce: 500 }" ng-change="search(searchString)">
    </div>

    <!-- Ordering -->
    <div class="col-lg-4 mt-1 mt-lg-0">
        <label for="ordering">Sorter resultat:</label>
        <div class="input-group">
            <select id="ordering" class="form-control"
                    ng-options="key as label for (key, label) in orderingFields"
                    ng-model="ordering.field">
            </select>

            <div class="input-group-append">
                <button class="btn btn-primary" type="button"
                        ng-click="ordering.ascending = !ordering.ascending">
                    <i class="fa fa-arrow-up" ng-show="ordering.ascending"></i>
                    <i class="fa fa-arrow-down" ng-show="!ordering.ascending"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Items -->
<div class="row">
    <!-- Filtering -->
    <div class="col-lg-3">
        <div ng-init="filtersCollapse = false;">
            <h4>Tilpass resultat</h4>

            <div uib-collapse="filtersCollapse">
                <uib-accordion close-others="false">
                    <div uib-accordion-group class="mt-1" is-open="isOpen" ng-repeat="filter in filters"
                         heading="{{ filter.title }}">
                        <!-- List filters -->
                        <div ng-if="filter.type == LIST">
                            <form class="m-2">
                                <input type="text" class="form-control" placeholder="Søk..."
                                       ng-model="filter.search" ng-model-options="{ debounce: 500 }">
                            </form>

                            <ul class="list-group list-group-flush">
                                <!-- Item list -->
                                <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center pointer"
                                    ng-repeat="item in filter.data.results"
                                    ng-show="filter.data.$resolved"
                                    ng-click="updateListFilter(filter, item)"
                                    ng-class="{ 'active': itemSelected(filter, item) }"
                                    role="button">
                                    {{ item.name }}
                                    <span class="badge badge-dark badge-pill">
                                        {{ item.number_of_products }}
                                    </span>
                                </li>

                                <li class="list-group-item" ng-show="!filter.data.$resolved">
                                    <i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>
                                </li>
                            </ul>

                            <div class="my-2 d-flex justify-content-center">
                                <custom-pagination model="filter.data" resource="filter.resource"
                                                   items-per-page="5" number-of-pages="5"
                                                   current-page="filter.filtering.page">
                                </custom-pagination>
                            </div>
                        </div>

                        <!-- Range filters -->
                        <div ng-if="filter.type == RANGE">
                            <div class="form m-2">
                                <!-- From value -->
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="Minimum"
                                               ng-model="filter.values[0]" ng-model-options="{ debounce: 500 }"
                                               ng-change="updateRangeFilter(filter)">
                                        <div class="input-group-append">
                                            <span class="input-group-text" ng-bind="filter.unit"></span>
                                        </div>
                                    </div>
                                </div>

                                <!-- To value -->
                                <div class="form-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="Maksimum"
                                               ng-model="filter.values[1]" ng-model-options="{ debounce: 500 }"
                                               ng-change="updateRangeFilter(filter)">
                                        <div class="input-group-append">
                                            <span class="input-group-text" ng-bind="filter.unit"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </uib-accordion>

                <button class="btn btn-primary my-3" ng-click="clearFilters()">
                    Tilbakestill
                </button>
            </div>
        </div>
    </div>

    <!-- Items -->
    <div class="col-lg-9">
        <div ng-show="!loading">
            <div class="row" ng-show="model.count > 0">
                <div class="col-12 col-sm-6 col-lg-4" ng-repeat="item in model.results">
                    <div class="card mb-3">
                        <img style="max-height: 200px;" class="img-fluid mx-auto d-block"
                            ng-src="https://bilder.vinmonopolet.no/cache/300x300-0/{{item.product_number}}-1.jpg">

                        <div class="card-body">
                            <h5 class="card-title" ng-bind="item.name"></h5>
                            <h6 class="card-subtitle mb-2 text-muted">
                                {{item.product_type.name}}
                                (<a class="item-details"
                                ui-sref="assortment.country({id: item.country.id})">{{ item.country.name }}</a>)
                            </h6>

                            <div class="mt-3 d-flex justify-content-between">
                                <h5>{{item.price | currency}}</h5>
                                <span>{{item.volume}} l</span>
                                <span>{{item.alcohol_content | number}}%</span>
                            </div>

                            <div class="text-muted">
                                {{item.alcohol_price | currency}} per liter alkohol
                            </div>

                            <div class="mt-3">
                                <a ng-href="http://www.vinmonopolet.no/vareutvalg/varedetaljer/sku-{{ item.product_number }}"
                                target="_blank"  class="btn btn-sm btn-primary" role="button">
                                    Vinmonopolet.no
                                </a>
                            </div>
                        </div>

                        <div class="card-footer">
                            <small class="text-muted">
                                Sist oppdatert for <span am-time-ago="item.last_updated"></span>
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <div ng-show="model.count == 0">
                Ingen varer samsvarer med dine valg
            </div>
        </div>

        <!-- Loading -->
        <div ng-show="loading" class="text-center mt-3">
            <i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>

            <span class="sr-only">Laster...</span>
        </div>
    </div>
</div>

<!-- Pagination -->
<div class="row mt-3" ng-show="!loading">
    <div class="offset-lg-3 col-lg-9 d-flex justify-content-center">
        <custom-pagination model="model" resource="resource" current-page="currentPage"
                           show-boundaries="true"></custom-pagination>
    </div>
</div>
